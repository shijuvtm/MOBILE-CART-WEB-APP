<section class="cart-section">
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8">
                <div class="cart-header mb-3">
                    <h4>My Cart ({{products.length}})</h4>
                </div>
                
                <div class="cart-items-container">
                    {{#each products}}
                    <div class="cart-item-card" id="row-{{this.product._id}}">
                        <div class="row align-items-center">
                            <div class="col-md-2 col-4 text-center">
                                <img src="/public/product-images/{{this.product._id}}.jpg" alt="{{this.product.Name}}" class="img-fluid cart-img">
                                <div class="quantity-controls mt-2">
                                    <button class="qty-btn" onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user}}',-1)">-</button>
                                    <span class="qty-val" id="{{this.product._id}}">{{this.quantity}}</span>
                                    <button class="qty-btn" onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user}}',1)">+</button>
                                </div>
                            </div>
                            
                            <div class="col-md-7 col-8">
                                <h5 class="product-name">{{this.product.Name}}</h5>
                                <p class="seller-text">Seller: RetailNet</p>
                                <p class="price-text">₹{{this.product.Price}}</p>
                            </div>
                            
                            <div class="col-md-3 col-12 text-md-right mt-3 mt-md-0">
                                <button class="btn-remove" onclick="removeFromCart('{{this._id}}','{{this.product._id}}')">REMOVE</button>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>

            <div class="col-lg-4">
                <div class="price-details-card">
                    <h6 class="price-header">PRICE DETAILS</h6>
                    <hr>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Price ({{products.length}} items)</span>
                        <span>₹{{totalValue}}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2 text-success">
                        <span>Delivery Charges</span>
                        <span>FREE</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between total-amount-row">
                        <h5>Total Amount</h5>
                        <h5>₹<span id="total">{{totalValue}}</span></h5>
                    </div>
                    <a href="/place-order" class="btn btn-orange btn-block mt-4">PLACE ORDER</a>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    body { background-color: #f1f3f6; font-family: Roboto, Arial, sans-serif; }
    
    .cart-section { margin-top: 20px; }
    
    /* Left Side Cards */
    .cart-header { background: #fff; padding: 15px 25px; border-bottom: 1px solid #f0f0f0; box-shadow: 0 1px 1px 0 rgba(0,0,0,.05); }
    
    .cart-item-card { background: #fff; padding: 25px; border-bottom: 1px solid #f0f0f0; transition: box-shadow .2s; }
    
    .cart-img { max-height: 100px; object-fit: contain; }
    
    .product-name { font-size: 18px; font-weight: 500; margin-bottom: 5px; }
    
    .seller-text { color: #878787; font-size: 14px; margin-bottom: 10px; }
    
    .price-text { font-size: 20px; font-weight: bold; }

    /* Quantity Buttons */
    .qty-btn { width: 28px; height: 28px; background: #fff; border: 1px solid #c2c2c2; border-radius: 50%; cursor: pointer; }
    
    .qty-val { margin: 0 10px; font-weight: bold; border: 1px solid #c2c2c2; padding: 3px 15px; }

    /* Buttons */
    .btn-remove { background: none; border: none; font-weight: bold; font-size: 16px; color: #212121; cursor: pointer; }
    .btn-remove:hover { color: #2874f0; }
    
    .btn-orange { background: #fb641b; color: white; border-radius: 2px; font-weight: bold; font-size: 16px; padding: 12px; box-shadow: 0 1px 2px 0 rgba(0,0,0,.2); }
    .btn-orange:hover { background: #f4511e; color: #fff; }

    /* Right Side Summary */
    .price-details-card { background: #fff; padding: 20px; position: sticky; top: 20px; box-shadow: 0 1px 1px 0 rgba(0,0,0,.05); }
    
    .price-header { color: #878787; font-weight: bold; margin-bottom: 15px; }
    
    .total-amount-row { border-top: 1px dashed #e0e0e0; padding-top: 20px; font-weight: bold; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  function changeQuantity(cartId,proId,userId,count){
    let quantity=parseInt(document.getElementById(proId).innerHTML)
     count=parseInt(count)

        console.log("Cart ID:", cartId);
        console.log("Product ID:", proId);
        console.log("Count:", count);
        console.log("Quantity:", quantity);

    $.ajax({
      url:'/change-product-quantity',
      data:{
        cart:cartId,
        product:proId,
        user:userId,
        count:count,
        quantity:quantity
      },
      method:'post',
      success:(response)=> {
        if(response.removeProduct){
          alert("Product Removed from cart")
          location.reload()
        }else{
          document.getElementById(proId).innerHTML = quantity + count;
          document.getElementById('total').innerHTML = response.total;
        }

      }
    })
  }
  function removeFromCart(cartId,proId){
    $.ajax({
      url:'/remove-from-cart',
      data:{
        cart:cartId,
        product:proId
      },
      method:'post',
      success:(response)=> {
        alert("Product Removed from cart")
        location.reload()
      }
    })
  }
</script>
