<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />
</head>
<style>
    body { padding-bottom:70px; background-color: #f1f3f6; font-family: Roboto, Arial, sans-serif; }
    
    
    .search-header {
        background-color: #2874f0;
        padding-top:20px;
        padding-bottom:10px;
        top:10;
        z-index: 1000;
        box-shadow: 0 2px 4px 0 rgba(0,0,0,.08);
    }
    .search-input {
        border: none;
        border-radius: 2px 0 0 2px;
        padding: 10px 16px;
        font-size: 14px;
        width: 100%;
        outline: none;
    }
    .search-btn {
        background-color: #fff;
        border: none;
        border-radius: 0 2px 2px 0;
        color: #2874f0;
        padding: 0 20px;
    }

    .fk-grid {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        justify-content: flex-end;
        background: #fff;
        border: 1px solid #e0e0e0;
    }

    .product-box {
        border: 0.5px solid #f0f0f0;
        transition: all 0.2s ease-in-out;
        background: #fff;
    }
    .product-box:hover {
        box-shadow: 0 3px 16px 0 rgba(0,0,0,.11);
        z-index: 1;
        transform: scale(1.01);
    }

    .img-container {
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 15px;
    }
    .img-container img {
        max-height: 100%;
        max-width: 100%;
        object-fit: contain;
    }

    .fk-title {
        font-size: 14px;
        font-weight: 500;
        color: #212121;
        margin-bottom: 5px;
        height: 38px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
    .fk-price { font-size: 18px; font-weight: 600; color: #212121; }
    .fk-btn {
        background: #ff9f00;
        color: #fff;
        border: none;
        font-weight: 600;
        border-radius: 2px;
        padding: 10px;
        font-size: 13px;
        text-transform: uppercase;
    }
</style>

<div class="search-header">
    <div class="container d-flex justify-content-center">
        <div class="d-flex mx-auto-10 w-75 ">
             <button class="search-btn"><i class="fas fa-search"></i></button>
            <input type="text" id="searchInput" class="search-input" placeholder="Search for products, brands and more">
        </div>
    </div>
</div>

<section class="py-4">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0 font-weight-bold" style="color: #212121;">Store Products</h5>
            <div>
                <a href="/view-products" class="btn btn-sm text-muted mr-2">Clear All</a>
                <button class="btn btn-white border px-4 font-weight-bold btn-sm" data-toggle="modal" data-target="#filterModal" style="background: #fff; border-radius: 2px;">
                    <i class="fas fa-filter mr-2 text-primary"></i>SORT & FILTER
                </button>
            </div>
        </div>

        <div class="row no-gutters fk-grid">
            {{#if products.length}}
                {{#each products}}
                <div class="col-xl-3 col-lg-4 col-md-6 col-6 product-box">
                    <div class="p-3 d-flex flex-column h-100">
                        <div class="img-container">
                            <img src="/public/product-images/{{this._id}}.jpg" alt="{{this.Name}}">
                        </div>
                        
                        <div class="mt-2 flex-grow-1">
                            <h2 class="fk-title">{{this.Name}}</h2>
                            <div class="mb-2">
                                <span class="badge badge-success" style="font-size: 11px;">4.2 ★</span>
                                <img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/fa_62673a.png" style="height: 15px; margin-left: 6px;" alt="Assured">
                            </div>
                            <div class="d-flex align-items-center">
                                <span class="fk-price">₹{{this.Price}}</span>
                                <small class="text-success ml-2 font-weight-bold">Free delivery</small>
                            </div>
                        </div>

                        <button onclick="addToCart('{{this._id}}')" class="btn fk-btn btn-block mt-3">
                            Add To Cart
                        </button>
                    </div>
                </div>
                {{/each}}
            {{else}}
                <div class="col-12 text-center py-5 bg-white border">
                    <img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/error-no-search-results_2353c5.png" style="width: 200px;">
                    <h4 class="mt-4">No results found!</h4>
                </div>
            {{/if}}
        </div>
    </div>
</section>

<div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form id="filterForm" method="GET" action="/view-products" class="w-100">
            <div class="modal-content" style="border-radius: 2px;">
                <div class="modal-header">
                    <h6 class="modal-title font-weight-bold">FILTERS</h6>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body p-4">
                    <div class="form-group">
                        <label class="small font-weight-bold text-muted">BRAND</label>
                        <select class="form-control" name="brand" id="brandSelect">
                            <option value="">All Brands</option>
                            {{#each brands}}
                            <option value="{{this}}">{{this}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="small font-weight-bold text-muted">PRICE RANGE</label>
                        <select class="form-control" name="price" id="priceSelect">
                          <option value="">All Prices</option>
                            <option value="0-10000">Under ₹10,000</option>
                            <option value="10001-30000">₹10,001 - ₹30,000</option>
                            <option value="30001-50000">₹30,001 - ₹50,000</option>
                            <option value="50001-200000">Over ₹50,000</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-primary btn-block py-2" style="background: #2874f0; border-radius: 2px;">APPLY</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    
    document.getElementById('searchInput').addEventListener('keyup', function() {
        let filter = this.value.toUpperCase();
        let products = document.querySelectorAll('.product-box');

        products.forEach(product => {
            let title = product.querySelector('.fk-title').innerText;
            if (title.toUpperCase().indexOf(filter) > -1) {
                product.style.display = "";
            } else {
                product.style.display = "none";
            }
        });
    });

    // 2. Persist Filter Values
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('brand')) document.getElementById('brandSelect').value = urlParams.get('brand');
        if (urlParams.get('price')) document.getElementById('priceSelect').value = urlParams.get('price');
    });

    // 3. Add to Cart Feedback
    function addToCart(productId) {
        // Here you would put your existing AJAX addToCart(productId) logic
        const btn = event.target;
        btn.innerHTML = "ADDED TO CART";
        btn.style.backgroundColor = "#388e3c";
        
        setTimeout(() => {
            btn.innerHTML = "ADD TO CART";
            btn.style.backgroundColor = "#ff9f00";
        }, 1500);
    }
</script>

