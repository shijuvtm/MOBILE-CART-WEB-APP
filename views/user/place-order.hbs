<section>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12 text-center">
                <h2>Enter Delivary Details</h2>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-6 offset-md-3">
                <form action="/place-order" method="POST">
                    <div class="form-group>
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                        <label for="address">Address</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                        <label for=""pincode">Pincode</label>
                        <input type="text" class="form-control" id="pincode" name="pincode" required>
                        <label for="phone">Mobile</label>
                        <input type="text" class="form-control" id="phone" name="phone" required>
                        <input type="text" name="userId" value="{{user._id}}" hidden>
                    </div>
                    <br>
                    <div class="form-group">
                        <label for="payment"><b style="font-size: large;"> Payment Method</b></label><hr>

                        <h4>Total Amount :Rs {{total}}</h4>

                        <input type="radio" name="Payment" value="COD" >COD<br>
                        <input type="radio" name="Payment" value="ONLINE" > Online Payment<br>

                        <button type="submit" class="btn btn-primary mt-3">checkout</button>
                    </div>
</section>

 <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>

<script>
    // Initialize Cashfree
    const cashfree = Cashfree({ mode: "sandbox" }); // Change to "production" for live

    $("#checkout-form").submit((e) => {
        e.preventDefault();
        $.ajax({
            url: "/place-order",
            type: "POST",
            data: $('#checkout-form').serialize(),
            success: (response) => {
                if (response.payment_method === 'COD') {
                    window.location.href = "/order-success";
                } else {
                    // 2. Launch Cashfree for Online Payment
                    cashfree.checkout({
                        paymentSessionId: response.payment_session_id,
                        returnUrl: "http://localhost:3000/verify-payment?order_id=" + response.order_id
                    });
                }
            },
            error: () => alert("Something went wrong")
        });
    });
</script>



